<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mr George Menu - Producto</title>
    <link rel="stylesheet" href="css/producto.css">
    <link rel="icon" type="image/png" href="img/logo-sin fondo.png">
</head>
<body>
    <header id="contenedor_header">
        <button id="btn-atras"><img id="btn-atras_logo" src="img/AtrasLogo.png" alt=""></button>
    </header>
    <main>
        <div id="contenedor_img_producto">
            <img id="imagen-producto" src="" alt="Imagen del producto">
        </div>
        <h1 id="nombre-producto"></h1>
        <p id="descripcion-producto"></p>
        <p id="precio-producto"></p>

        <!-- Nuevo textarea para sugerencias -->
        <div>
            <h3 id="text_instrucciones">Instrucciones adicionales</h3>
            <textarea id="instrucciones" placeholder="Ingresa sugerencias sobre la preparación"></textarea>
        </div>

        <div id="contenedor_cantidad_btn-agregar">
            <div id="contenedor_cantidad">
                <button id="btn-restar">-</button>
                <span id="cantidad">1</span>
                <button id="btn-sumar">+</button>
            </div>
            <div id="contenedor_btn-agregar">
                <button id="btn-agregar">AGREGAR $VALOR</button>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const producto = JSON.parse(localStorage.getItem('productoSeleccionado'));
            if (!producto) {
                console.error('No se encontró el producto en localStorage.');
                window.location.href = 'index.html';
                return;
            }

            document.getElementById('nombre-producto').textContent = producto.nombre || 'Nombre no disponible';
            document.getElementById('descripcion-producto').textContent = producto.descripcion || 'Descripción no disponible';
            document.getElementById('precio-producto').textContent = `$${producto.precio || '0.00'}`;
            document.getElementById('imagen-producto').src = producto.imagen || 'img/default.png';

            // Establecer la cantidad inicial desde localStorage
            document.getElementById('cantidad').textContent = producto.cantidad || 1;

            function modificarCantidad(cambio) {
                const cantidadElemento = document.getElementById('cantidad');
                let cantidad = parseInt(cantidadElemento.textContent);
                cantidad += cambio;
                if (cantidad < 1) cantidad = 0;
                cantidadElemento.textContent = cantidad;

                // Si la cantidad llega a 0, eliminar el producto del carrito y redirigir
                if (cantidad === 0) {
                    eliminarDelCarrito();
                    window.location.href = 'index.html';
                }
            }

            function agregarAlCarrito() {
                const cantidad = parseInt(document.getElementById('cantidad').textContent);
                const instrucciones = document.getElementById('instrucciones').value;  // Capturar las instrucciones adicionales

                if (cantidad <= 0) {
                    eliminarDelCarrito();
                    return;
                }

                const productoFinal = {
                    ...producto,
                    cantidad: cantidad,
                    instrucciones: instrucciones // Agregar las instrucciones al objeto producto
                };

                let carrito = obtenerCarrito();
                let productoExistente = carrito.find(item => item.id === productoFinal.id);

                if (productoExistente) {
                    productoExistente.cantidad = cantidad;
                    productoExistente.instrucciones = instrucciones; // Actualizar instrucciones si ya existe en el carrito
                } else {
                    carrito.push(productoFinal);
                }

                localStorage.setItem('carrito', JSON.stringify(carrito));
                window.location.href = 'index.html';
            }

            function eliminarDelCarrito() {
                let carrito = obtenerCarrito();
                carrito = carrito.filter(item => item.id !== producto.id);
                localStorage.setItem('carrito', JSON.stringify(carrito));
            }

            function volverAlMenu() {
                window.location.href = 'index.html';
            }

            function obtenerCarrito() {
                const carrito = localStorage.getItem('carrito');
                return carrito ? JSON.parse(carrito) : [];
            }

            document.getElementById('btn-atras').addEventListener('click', volverAlMenu);
            document.getElementById('btn-restar').addEventListener('click', () => modificarCantidad(-1));
            document.getElementById('btn-sumar').addEventListener('click', () => modificarCantidad(1));
            document.getElementById('btn-agregar').addEventListener('click', agregarAlCarrito);
        });
    </script>
</body>
</html>
